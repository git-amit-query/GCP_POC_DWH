Party_ID:INTEGER,Party_source_Code:INTEGER,Party_Name:STRING,Party_Type:STRING,Start_Date:DATE,End_Date:DATE
FAC_NO:INTEGER,Facility_id:INTEGER,Facility_Source_code:INTEGER,Facility_name:STRING,Facility_Type:STRING,Currency_Code:STRING,START_DATE:DATE,END_DATE:DATE
PARTY_ID:INTEGER ,FACILITY_ID:INTEGER ,Start_date:DATE,End_Date:DATE
FACILITY_ID:INTEGER,ARRANGEMENT_DIM:INTEGER,Start_date:DATE,End_Date:DATE
SLNO:INTEGER,Arrangement_ID:INTEGER,Snapshot_DATE:DATE,Snapshot_Date_ID:INTEGER,Limit:DECIMAL,Limit_GBP:DECIMAL,Balance:DECIMAL,Balance_GBP:DECIMAL,BI_INSERT_DATE:DATE,BI_UPDATE_DATE:DATE,Undrawn_amount:DECIMAL,Undrawn_amount_GBP:DECIMAL,Cleared_Balance:DECIMAL,Cleared_Balance_GBP:DECIMAL
Arrangement_Source_code:INTEGER ,Source_System_CD:STRING,MATURITY_DATE_ID:DATE,PAYMENT_TYPE_ID:INTEGER,ACCOUNT_FLAG:STRING,LARGE_PRINT_IDICATOR:INTEGER,STRAT_DATE:DATE,END_DATE:DATE






SELECT  E.Party_Name_, A.Snapshot_DATE ,MAX(A.Limit) , SUM(A.BALANCE)    
FROM    DWH.DAILY_FACT   A  
INNER JOIN  DWH.ARR  B
ON  A.Arrangement_ID  = B.Arrangement_Source_code_
INNER JOIN  DWH.FAC_X_ARR  C 
ON  B.Arrangement_Source_code_  =  C.ARRANGEMENT_DIM 
INNER JOIN  DWH.FAC_X_PARTY   D 
ON  C.FACILITY_ID  =  D.FACILITY_ID_ 
INNER JOIN  DWH.PARTY  E 
ON D.PARTY_ID_   =  E.Party_source_Code	  
GROUP  BY  E.Party_Name_, A.Snapshot_DATE 
ORDER BY  E.Party_Name_